# ğŸ›ï¸ SYSTEM BLUEPRINT (Core Logic)

**Last Updated**: January 1, 2026  
**Status**: âœ… COMPLETE (12/12 Phases) - Backend fully enhanced with security, validation, and structured logging

## 1. Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù†ÙŠ
> For detailed technical specifications, refer to:
> - [ARCHITECTURE.md](./ARCHITECTURE.md)
> - [API_SPEC.md](./API_SPEC.md)
> - [DESIGN_SYSTEM.md](./DESIGN_SYSTEM.md)
> - [ENHANCEMENT_SUMMARY.md](./ENHANCEMENT_SUMMARY.md) - Latest backend improvements
> - [IMPLEMENTATION_GUIDE.md](./IMPLEMENTATION_GUIDE.md) - Development patterns


```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Frontend (React + Vite)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Ø§Ù„Ø£Ø¯Ù…Ù†  â”‚ â”‚Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©  â”‚ â”‚Ø§Ù„Ø´Ø¦ÙˆÙ†   â”‚ â”‚Ù…Ø±ÙƒØ²     â”‚ â”‚ Ø§Ù„ÙØ±Ø¹   â”‚ â”‚Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± â”‚       â”‚
â”‚  â”‚         â”‚ â”‚         â”‚ â”‚Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© â”‚ â”‚Ø§Ù„ØµÙŠØ§Ù†Ø©  â”‚ â”‚         â”‚ â”‚         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                  â”‚                                                              â”‚
â”‚            API Client (client.ts)                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â–¼                                                              â”‚
â”‚           Backend (Express.js) - âœ… Enhanced (12/12 Phases)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Middleware Stack                                     â”‚    â”‚
â”‚  â”‚  âœ… helmet (security headers)                                           â”‚    â”‚
â”‚  â”‚  âœ… pino-http (structured logging)                                      â”‚    â”‚
â”‚  â”‚  âœ… rateLimiter (100 req/15min)                                         â”‚    â”‚
â”‚  â”‚  âœ… authenticateToken â†’ checkPermissions â†’ req.user (id, branchId, role)â”‚   â”‚
â”‚  â”‚  âœ… Data isolation enforced via getBranchFilter                         â”‚    â”‚
â”‚  â”‚  âœ… Global error handler with custom error classes                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       Routes        â”‚                Services                             â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ customers.js âœ… â”‚ â”‚ â”‚ inventoryService.js                          â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ requests.js     â”‚ â”‚ â”‚ requestService.js                            â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ inventory.js    â”‚ â”‚ â”‚ paymentService.js                            â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ payments.js     â”‚ â”‚ â”‚ transferService.js                           â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ sales.js        â”‚ â”‚ â”‚ permissionsService.js  â† ğŸ†•                   â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ branches.js     â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚ â”‚ warehouse-*     â”‚ â”‚                                                     â”‚  â”‚
â”‚  â”‚ â”‚ transfer-orders â”‚ â”‚ ğŸ“¦ New Utilities:                                   â”‚  â”‚
â”‚  â”‚ â”‚ approvals.js    â”‚ â”‚ - logger.js (Pino structured logging)              â”‚  â”‚
â”‚  â”‚ â”‚ health.js âœ…    â”‚ â”‚ - errors.js (6 custom error classes)               â”‚  â”‚
â”‚  â”‚ â”‚ swagger.js âœ…   â”‚ â”‚ - errorHandler.js (global error middleware)        â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ - asyncHandler.js (wrapper for async routes)       â”‚  â”‚
â”‚  â”‚                     â”‚ - validation/ (Zod schemas + middleware)           â”‚  â”‚
â”‚  â”‚                     â”‚ - config/ (centralized environment config)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         Prisma ORM (db.js)                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SQLite Database (dev.db)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø®Ù…Ø³Ø© (5-Screen Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø®Ù…Ø³Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Ø§Ù„Ø£Ø¯Ù…Ù†      â”‚  Role: SUPER_ADMIN
â”‚  (Admin)        â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª       â”‚
â”‚ - Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ±Ø²     â”‚
â”‚ - Ø¥Ø¯Ø§Ø±Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†â”‚
â”‚ - ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©     â”‚  Role: MANAGEMENT
â”‚  (Management)   â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø©  â”‚
â”‚ - ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹    â”‚
â”‚ - ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ²   â”‚
â”‚ - Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               Ø§Ù„Ø´Ø¦ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©                                   â”‚
â”‚                            (Administrative Affairs)                              â”‚
â”‚  Role: ADMIN_AFFAIRS           Branch Type: ADMIN_AFFAIRS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ Ù…Ø®Ø²ÙˆÙ† Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©    â†’    ÙŠØ±Ø³Ù„ Ù„Ù„ÙØ±ÙˆØ¹                                    â”‚
â”‚  ğŸ“± Ù…Ø®Ø²ÙˆÙ† Ø´Ø±Ø§Ø¦Ø­ Ø¨ÙŠØ§Ù†Ø§Øª     â†’    ÙŠØ±Ø³Ù„ Ù„Ù„ÙØ±ÙˆØ¹                                    â”‚
â”‚  ğŸ‘ï¸ Ø¹Ø±Ø¶ Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙØ±ÙˆØ¹ (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚
                                                 â”‚ TransferOrder (NEW_STOCK)
                                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                  â”‚                              â”‚
              â–¼                                  â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© 1        â”‚    â”‚    Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© 2        â”‚    â”‚    Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© 3        â”‚
â”‚  (Maintenance Center)    â”‚    â”‚  (Maintenance Center)    â”‚    â”‚  (Maintenance Center)    â”‚
â”‚  Role: CENTER_MANAGER    â”‚    â”‚  Role: CENTER_MANAGER    â”‚    â”‚  Role: CENTER_MANAGER    â”‚
â”‚  Branch: MAINTENANCE_CENTERâ”‚  â”‚  Branch: MAINTENANCE_CENTERâ”‚  â”‚  Branch: MAINTENANCE_CENTERâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”§ Ù…Ø®Ø²ÙˆÙ† Ù‚Ø·Ø¹ ØºÙŠØ§Ø±        â”‚    â”‚ ğŸ”§ Ù…Ø®Ø²ÙˆÙ† Ù‚Ø·Ø¹ ØºÙŠØ§Ø±        â”‚    â”‚ ğŸ”§ Ù…Ø®Ø²ÙˆÙ† Ù‚Ø·Ø¹ ØºÙŠØ§Ø±        â”‚
â”‚ â¤´ï¸ ØªØ­ÙˆÙŠÙ„ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù„Ù„ÙØ±ÙˆØ¹ â”‚    â”‚ â¤´ï¸ ØªØ­ÙˆÙŠÙ„ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù„Ù„ÙØ±ÙˆØ¹ â”‚    â”‚ â¤´ï¸ ØªØ­ÙˆÙŠÙ„ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù„Ù„ÙØ±ÙˆØ¹ â”‚
â”‚ ğŸ“¥ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù…Ø§ÙƒÙŠÙ†Ø§Øª ØµÙŠØ§Ù†Ø© â”‚    â”‚ ğŸ“¥ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù…Ø§ÙƒÙŠÙ†Ø§Øª ØµÙŠØ§Ù†Ø© â”‚    â”‚ ğŸ“¥ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù…Ø§ÙƒÙŠÙ†Ø§Øª ØµÙŠØ§Ù†Ø© â”‚
â”‚ ğŸ“¤ Ø¥Ø±Ø¬Ø§Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­     â”‚    â”‚ ğŸ“¤ Ø¥Ø±Ø¬Ø§Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­     â”‚    â”‚ ğŸ“¤ Ø¥Ø±Ø¬Ø§Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­     â”‚
â”‚ ğŸ‘ï¸ Ø¹Ø±Ø¶ Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙØ±ÙˆØ¹     â”‚    â”‚ ğŸ‘ï¸ Ø¹Ø±Ø¶ Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙØ±ÙˆØ¹     â”‚    â”‚ ğŸ‘ï¸ Ø¹Ø±Ø¶ Ù…Ø®Ø²ÙˆÙ† Ø§Ù„ÙØ±ÙˆØ¹     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                               â”‚                               â”‚
     ÙŠØ®Ø¯Ù… ÙØ±ÙˆØ¹                        ÙŠØ®Ø¯Ù… ÙØ±ÙˆØ¹                        ÙŠØ®Ø¯Ù… ÙØ±ÙˆØ¹
             â”‚                               â”‚                               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
     â–¼               â–¼               â–¼               â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÙØ±Ø¹ 1   â”‚   â”‚ ÙØ±Ø¹ 2   â”‚     â”‚ ÙØ±Ø¹ 3   â”‚   â”‚ ÙØ±Ø¹ 4   â”‚     â”‚ ÙØ±Ø¹ 5   â”‚   â”‚ ÙØ±Ø¹ 6 â”‚
â”‚ BRANCH  â”‚   â”‚ BRANCH  â”‚     â”‚ BRANCH  â”‚   â”‚ BRANCH  â”‚     â”‚ BRANCH  â”‚   â”‚ BRANCH  â”‚
â”‚ Role:   â”‚   â”‚ Role:   â”‚     â”‚ Role:   â”‚   â”‚ Role:   â”‚     â”‚ Role:   â”‚   â”‚ Role:   â”‚
â”‚ BRANCH_ â”‚   â”‚ BRANCH_ â”‚     â”‚ BRANCH_ â”‚   â”‚ BRANCH_ â”‚     â”‚ BRANCH_ â”‚   â”‚ BRANCH_ â”‚
â”‚ MANAGER â”‚   â”‚ MANAGER â”‚     â”‚ MANAGER â”‚   â”‚ MANAGER â”‚     â”‚ MANAGER â”‚   â”‚ MANAGER â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ğŸ‘¤Ø¹Ù…Ù„Ø§Ø¡  â”‚   â”‚ğŸ‘¤Ø¹Ù…Ù„Ø§Ø¡  â”‚     â”‚ğŸ‘¤Ø¹Ù…Ù„Ø§Ø¡  â”‚   â”‚ğŸ‘¤Ø¹Ù…Ù„Ø§Ø¡  â”‚     â”‚ğŸ‘¤Ø¹Ù…Ù„Ø§Ø¡  â”‚   â”‚ğŸ‘¤Ø¹Ù…Ù„Ø§Ø¡  â”‚
â”‚ğŸ“¦Ù…Ø®Ø²Ù†   â”‚   â”‚ğŸ“¦Ù…Ø®Ø²Ù†   â”‚     â”‚ğŸ“¦Ù…Ø®Ø²Ù†   â”‚   â”‚ğŸ“¦Ù…Ø®Ø²Ù†   â”‚     â”‚ğŸ“¦Ù…Ø®Ø²Ù†   â”‚   â”‚ğŸ“¦Ù…Ø®Ø²Ù†   â”‚
â”‚ğŸ”§ØµÙŠØ§Ù†Ø©  â”‚   â”‚ğŸ”§ØµÙŠØ§Ù†Ø©  â”‚     â”‚ğŸ”§ØµÙŠØ§Ù†Ø©  â”‚   â”‚ğŸ”§ØµÙŠØ§Ù†Ø©  â”‚     â”‚ğŸ”§ØµÙŠØ§Ù†Ø©  â”‚   â”‚ğŸ”§ØµÙŠØ§Ù†Ø©  â”‚
â”‚ğŸ”„Ø§Ø³ØªØ¨Ø¯Ø§Ù„â”‚   â”‚ğŸ”„Ø§Ø³ØªØ¨Ø¯Ø§Ù„â”‚     â”‚ğŸ”„Ø§Ø³ØªØ¨Ø¯Ø§Ù„â”‚   â”‚ğŸ”„Ø§Ø³ØªØ¨Ø¯Ø§Ù„â”‚     â”‚ğŸ”„Ø§Ø³ØªØ¨Ø¯Ø§Ù„â”‚   â”‚ğŸ”„Ø§Ø³ØªØ¨Ø¯Ø§Ù„â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Roles & Permissions)

### Ø§Ù„Ø£Ø¯ÙˆØ§Ø± (User Roles)

| Ø§Ù„Ø¯ÙˆØ± | Ø§Ù„Ø´Ø§Ø´Ø© | Ø§Ù„ÙˆØµÙ |
|-------|--------|-------|
| `SUPER_ADMIN` | Ø§Ù„Ø£Ø¯Ù…Ù† | Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… - ÙƒÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª |
| `MANAGEMENT` | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø© - Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø· |
| `ADMIN_AFFAIRS` | Ø§Ù„Ø´Ø¦ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© | Ø¥Ø¯Ø§Ø±Ø© Ù…Ø®Ø²ÙˆÙ† Ù…Ø§ÙƒÙŠÙ†Ø§Øª/Ø´Ø±Ø§Ø¦Ø­ Ø¬Ø¯ÙŠØ¯Ø© |
| `CENTER_MANAGER` | Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© | Ù…Ø¯ÙŠØ± Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© |
| `CENTER_TECH` | Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© | ÙÙ†ÙŠ ÙÙŠ Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© |
| `BRANCH_TECH` | Ø§Ù„ÙØ±Ø¹ | ÙÙ†ÙŠ Ø§Ù„ÙØ±Ø¹ - ØµÙ„Ø§Ø­ÙŠØ§Øª ØªØ´ØºÙŠÙ„ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ù„Ù„ÙØ±Ø¹ |
| `CS_SUPERVISOR` | Ø§Ù„ÙØ±Ø¹ | Ù…Ø´Ø±Ù Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Modern) |
| `CS_AGENT` | Ø§Ù„ÙØ±Ø¹ | Ù…ÙˆØ¸Ù Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Modern) |
| `BRANCH_MANAGER` | Ø§Ù„ÙØ±Ø¹ | (Legacy) - Ù…Ù…Ø³ÙˆØ­ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù€ CS_SUPERVISOR |
| `TECHNICIAN` | Ø§Ù„ÙØ±Ø¹ | (Deprioritized) - Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ù‡ÙŠ CS_AGENT |

### Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ÙØ±ÙˆØ¹ (Branch Types)

| Ø§Ù„Ù†ÙˆØ¹ | Ø§Ù„ÙˆØµÙ |
|-------|-------|
| `BRANCH` | ÙØ±Ø¹ Ø¹Ø§Ø¯ÙŠ - ÙŠØ®Ø¯Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ |
| `MAINTENANCE_CENTER` | Ù…Ø±ÙƒØ² ØµÙŠØ§Ù†Ø© - ÙŠØ®Ø¯Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© ÙØ±ÙˆØ¹ |
| `ADMIN_AFFAIRS` | Ø§Ù„Ø´Ø¦ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© - Ù…Ø®Ø²ÙˆÙ† Ø±Ø¦ÙŠØ³ÙŠ |

### Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

| Role | Customers | Maintenance | Inventory | Transfers | Reports | Users | Finance |
|------|-----------|-------------|-----------|-----------|---------|-------|---------|
| `SUPER_ADMIN` | âœ… All | âœ… All | âœ… All | âœ… All | âœ… All | âœ… All | ğŸ‘ï¸ (Hidden) |
| `MANAGEMENT` | ğŸ‘ï¸ All | ğŸ‘ï¸ All | ğŸ‘ï¸ All | ğŸ‘ï¸ All | âœ… All | âŒ | ğŸ‘ï¸ (Hidden) |
| `ADMIN_AFFAIRS` | âŒ | âŒ | âœ… New Machines/SIMs | âœ… To Branches | âœ… All | âŒ | âŒ |
| `CENTER_MANAGER` | âŒ | âœ… External | âœ… Spare Parts | âœ… To Branches | âœ… All | âŒ | âŒ |
| `CENTER_TECH` | âŒ | âœ… External | ğŸ‘ï¸ Spare Parts | âŒ | âœ… All | âŒ | âŒ |
| `CS_SUPERVISOR` | âœ… Own | âœ… Own | âœ… Receive | ğŸ“¤ To Center | âœ… All | âŒ | âœ… Own |
| `CS_AGENT` | âœ… Own | âœ… Own | âœ… Receive | âŒ | âœ… All | âŒ | âŒ |

### ğŸ›‚ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ù„Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Dynamic Permissions System)

ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø«Ø§Ø¨Øª Ø¨Ù†Ø¸Ø§Ù… Ù…Ø±Ù† ÙŠØ³Ù…Ø­ Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ù† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:

1.  **Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Settings > Permissions):** ØªØ¹Ø±Ø¶ ÙƒÙ„ ØµÙØ­Ø© ÙˆØ¥Ø¬Ø±Ø§Ø¡ Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªÙØ¹ÙŠÙ„/Ø§Ù„ØªØ¹Ø·ÙŠÙ„ Ù„ÙƒÙ„ Ø¯ÙˆØ±.
2.  **Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:** ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙÙŠ Ø¬Ø¯ÙˆÙ„ `RolePermission`.
3.  **Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø³Ù‚ÙˆØ· (Fallback):** ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø®ØµØµ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙŠÙ„ØªØ²Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ (`permissions.js` / `permissions.ts`).
4.  **Ø­Ù…Ø§ÙŠØ© Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…:** Ù‡Ù†Ø§Ùƒ Ù‚ÙŠÙˆØ¯ ØªÙ…Ù†Ø¹ Ø³Ø­Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù€ `SUPER_ADMIN` Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØºÙ„Ù‚ Ø§Ù„Ù†Ø¸Ø§Ù….


### Dashboard Logic (Allow-List Protocol)
Operational buttons ("New Request", "Record Payment") are visible **ONLY** to front-office roles:
- `SUPER_ADMIN`
- `BRANCH_MANAGER`
- `TECHNICIAN`

All other roles (`ADMIN_AFFAIRS`, `MANAGEMENT`, `CENTER_MANAGER`) see only relevant statistical widgets (Inventory, Alerts).

### Admin Affairs Workflow (Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)

**Concept:** Admin Affairs is NOT a branch - it's central inventory management.

**UI Differences:**
- Page Title: "Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù…Ø§ÙƒÙŠÙ†Ø§Øª" (not "Ø¨Ø§Ù„ÙØ±Ø¹")
- Hidden Tabs: `CLIENT_REPAIR` (not applicable)
- Hidden Actions: Sale, Exchange, Return to Customer

**Transfer Flow:**
1. Admin Affairs adds machines to their warehouse
2. Multi-select machines using checkboxes
3. Click "ØªØ­ÙˆÙŠÙ„ (N)" button
4. Select destination branch
5. System auto-generates Transfer Order with unique number
6. Branch receives notification
7. Branch accepts/rejects (full or partial)

---

## 4. Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª (Entity Relationships)

### Ø§Ù„ÙØ±Ø¹ ÙˆÙ…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø©

```prisma
model Branch {
  id                 String    @id
  code               String    @unique
  name               String
  type               String    @default("BRANCH")
  // Types: BRANCH, MAINTENANCE_CENTER, ADMIN_AFFAIRS
  
  // Ø±Ø¨Ø· Ø§Ù„ÙØ±Ø¹ Ø¨Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„ØªØ§Ø¨Ø¹ Ù„Ù‡
  maintenanceCenterId String?
  maintenanceCenter   Branch?   @relation("BranchToCenter")
  servicedBranches    Branch[]  @relation("BranchToCenter")
}
```

### Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Ø±

```prisma
model User {
  id               String   @id
  email            String?
  displayName      String?
  role             String   @default("TECHNICIAN")
  // Roles: SUPER_ADMIN, MANAGEMENT, ADMIN_AFFAIRS,
  //        CENTER_MANAGER, CENTER_TECH, BRANCH_MANAGER, TECHNICIAN
  branchId         String?
  branch           Branch?  @relation()
}

model SystemLog {
  id               String   @id
  branchId         String?  // Every log is attributed to a branch
  branch           Branch?  @relation(fields: [branchId], references: [id])
  userId           String?
  performedBy      String
  action           String
  entityType       String
  entityId         String
  details          String
  createdAt        DateTime @default(now())
}
```

---

## 5. Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª (Transfer Types)

| Ø§Ù„Ù†ÙˆØ¹ | Ù…Ù† | Ø¥Ù„Ù‰ | Ø§Ù„Ù…Ø­ØªÙˆÙ‰ |
|-------|------|------|---------|
| `NEW_STOCK` | Ø§Ù„Ø´Ø¦ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© | Ø§Ù„ÙØ±ÙˆØ¹/Ø§Ù„Ù…Ø±Ø§ÙƒØ² | Ù…Ø§ÙƒÙŠÙ†Ø§Øª/Ø´Ø±Ø§Ø¦Ø­ Ø¬Ø¯ÙŠØ¯Ø© |
| `SPARE_PARTS` | Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© | Ø§Ù„ÙØ±Ø¹ | Ù‚Ø·Ø¹ ØºÙŠØ§Ø± |
| `SEND_TO_CENTER` | Ø§Ù„ÙØ±Ø¹ | Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© | Ù…Ø§ÙƒÙŠÙ†Ø© Ù„Ù„ØµÙŠØ§Ù†Ø© |
| `RETURN_TO_BRANCH` | Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© | Ø§Ù„ÙØ±Ø¹ | Ù…Ø§ÙƒÙŠÙ†Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ |
| `MAINTENANCE` | Ø§Ù„ÙØ±Ø¹ / Ø§Ù„Ù…Ø±ÙƒØ² | Ø§Ù„Ù…Ø±ÙƒØ² / Ø§Ù„ÙØ±Ø¹ | Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ù…Ø±Ø³Ù„Ø© Ù„Ù„ØµÙŠØ§Ù†Ø© Ø£Ùˆ Ø¹Ø§Ø¦Ø¯Ø© Ù…Ù†Ù‡Ø§ |
| `MACHINE` | Ø£ÙŠ | Ø£ÙŠ | Ù…Ø§ÙƒÙŠÙ†Ø© Ù…Ø³ØªØ¹Ù…Ù„Ø© |
| `SIM` | Ø£ÙŠ | Ø£ÙŠ | Ø´Ø±ÙŠØ­Ø© Ø¨ÙŠØ§Ù†Ø§Øª |

---

## 6. Ø¯ÙˆØ±Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Complete Workflow)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            Ø§Ù„Ø´Ø¦ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©              â”‚
                    â”‚         (Administrative Affairs)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                          ğŸ“¦ Ù…Ø§ÙƒÙŠÙ†Ø§Øª/Ø´Ø±Ø§Ø¦Ø­ Ø¬Ø¯ÙŠØ¯Ø©
                          TransferOrder (NEW_STOCK)
                                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                        â”‚                        â”‚
              â–¼                        â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø©   â”‚     â”‚   Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø©   â”‚     â”‚   Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø©   â”‚
    â”‚                  â”‚     â”‚                  â”‚     â”‚                  â”‚
    â”‚  ğŸ”§ Ù‚Ø·Ø¹ ØºÙŠØ§Ø±     â”‚     â”‚  ğŸ”§ Ù‚Ø·Ø¹ ØºÙŠØ§Ø±     â”‚     â”‚  ğŸ”§ Ù‚Ø·Ø¹ ØºÙŠØ§Ø±     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                        â”‚                        â”‚
             â”‚ SPARE_PARTS            â”‚ SPARE_PARTS            â”‚ SPARE_PARTS
             â”‚                        â”‚                        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
    â–¼                 â–¼      â–¼                 â–¼      â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÙØ±Ø¹ 1 â”‚         â”‚ ÙØ±Ø¹ 2 â”‚ â”‚ ÙØ±Ø¹ 3 â”‚     â”‚ ÙØ±Ø¹ 4 â”‚ â”‚ ÙØ±Ø¹ 5 â”‚     â”‚ ÙØ±Ø¹ 6 â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚                 â”‚         â”‚             â”‚         â”‚             â”‚
    â”‚                 â”‚         â”‚             â”‚         â”‚             â”‚
    â–¼                 â–¼         â–¼             â–¼         â–¼             â–¼
ğŸ‘¤ Ø¹Ù…ÙŠÙ„           ğŸ‘¤ Ø¹Ù…ÙŠÙ„    ğŸ‘¤ Ø¹Ù…ÙŠÙ„      ğŸ‘¤ Ø¹Ù…ÙŠÙ„    ğŸ‘¤ Ø¹Ù…ÙŠÙ„      ğŸ‘¤ Ø¹Ù…ÙŠÙ„
    â”‚
    â”‚ Ù…Ø§ÙƒÙŠÙ†Ø© Ø¨Ù‡Ø§ Ù…Ø´ÙƒÙ„Ø©
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Ø¯ÙˆØ±Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ØµÙŠØ§Ù†Ø© Ø¯Ø§Ø®Ù„ÙŠØ©  â”‚     â”‚ØµÙŠØ§Ù†Ø© Ø®Ø§Ø±Ø¬ÙŠØ©  â”‚                                  â”‚
â”‚  â”‚(ÙÙŠ Ø§Ù„ÙØ±Ø¹)    â”‚     â”‚(ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ²)   â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚         â”‚                    â”‚                                          â”‚
â”‚         â”‚                    â”‚ 1. Ø§Ø³ØªÙ„Ø§Ù… Ø¨Ø§Ù„ÙØ±Ø¹ (EXTERNAL_REPAIR)       â”‚
â”‚         â”‚                    â”‚ 2. ØªØ­ÙˆÙŠÙ„ Ø¬Ù…Ø§Ø¹ÙŠ (Bulk Transfer + Waybill) â”‚
â”‚         â”‚                    â”‚    SEND_TO_CENTER (MAINTENANCE)          â”‚
â”‚         â”‚                    â–¼                                          â”‚
â”‚         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚         â”‚            â”‚   Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø©   â”‚                               â”‚
â”‚         â”‚            â”‚   ÙŠØ³ØªÙ„Ù… (AT_CENTER)â”‚                               â”‚
â”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚         â”‚                     â”‚                                          â”‚
â”‚         â”‚                     â”‚ RETURN_TO_BRANCH                         â”‚
â”‚         â”‚                     â–¼                                          â”‚
â”‚         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚         â”‚            â”‚  Ø§Ù„ÙØ±Ø¹ ÙŠØ³ØªÙ„Ù…     â”‚                               â”‚
â”‚         â”‚            â”‚  READY_DELIVERY  â”‚                               â”‚
â”‚         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚         â”‚                     â”‚                                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                          â”‚
â”‚                               â–¼                                          â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                      â”‚  ØªØ³Ù„ÙŠÙ… Ù„Ù„Ø¹Ù…ÙŠÙ„    â”‚                               â”‚
â”‚                      â”‚  Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø·Ù„Ø¨     â”‚                               â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. API Endpoints Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±

### Ø§Ù„Ø£Ø¯Ù…Ù† (SUPER_ADMIN)
- `GET/POST/PUT/DELETE` - ÙƒÙ„ Ø§Ù„Ù€ endpoints

### Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (MANAGEMENT)
- `GET /branches` - ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹
- `GET /reports/*` - ÙƒÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
- `GET /dashboard/all` - Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø©

### Ø§Ù„Ø´Ø¦ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© (ADMIN_AFFAIRS)
- `GET /warehouse-machines` - Ù…Ø®Ø²ÙˆÙ†Ù‡
- `POST /transfer-orders` - Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ÙØ±ÙˆØ¹
- `GET /branches/:id/inventory` - Ø¹Ø±Ø¶ Ù…Ø®Ø²ÙˆÙ† ÙØ±Ø¹ (Ù‚Ø±Ø§Ø¡Ø©)

### Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© (CENTER_MANAGER/CENTER_TECH)
- `GET /warehouse-machines/external-repair` - Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
- `GET /inventory` - Ù…Ø®Ø²ÙˆÙ† Ù‚Ø·Ø¹ Ø§Ù„ØºÙŠØ§Ø±
- `POST /transfer-orders` - ØªØ­ÙˆÙŠÙ„ Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ù„Ù„ÙØ±ÙˆØ¹
- `GET /branches/:id/inventory` - Ø¹Ø±Ø¶ Ù…Ø®Ø²ÙˆÙ† ÙØ±ÙˆØ¹Ù‡

### Ø§Ù„ÙØ±Ø¹ (BRANCH_MANAGER/TECHNICIAN)
- `GET /customers` - Ø¹Ù…Ù„Ø§Ø¡ ÙØ±Ø¹Ù‡
- `GET/POST /requests` - Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© (takeMachine: true Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…)
- `GET /inventory` - Ù…Ø®Ø²ÙˆÙ†Ù‡
- `POST /warehouse-machines/bulk-transfer` - ØªØ­ÙˆÙŠÙ„ Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ù…Ø±ÙƒØ²
- `POST /warehouse-machines/external-repair/withdraw` - Ø³Ø­Ø¨ Ù…Ø§ÙƒÙŠÙ†Ø© Ù…ÙØ±Ø¯Ø©

---

## 8. Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°

### âœ… Ù…ÙƒØªÙ…Ù„:
1. ~~Ø¹Ø¯Ù… ØªØ·Ø§Ø¨Ù‚ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø¨ÙŠÙ† Schema ÙˆØ§Ù„ÙƒÙˆØ¯~~
2. ~~Ù†Ù‚Øµ branchId ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„~~
3. ~~Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Authentication Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ù€ Routes~~
4. âœ… Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© (External Repair)
5. âœ… Ø­Ù‚ÙˆÙ„ ØªØªØ¨Ø¹ WarehouseMachine
6. âœ… Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø³Ø¨Ø¹Ø© ÙÙŠ User.role
7. âœ… Ø±Ø¨Ø· Ø§Ù„ÙØ±Ø¹ Ø¨Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© (maintenanceCenterId)
8. âœ… Middleware Ù„Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (backend: permissions.js)
9. âœ… ØªØ­Ø¯ÙŠØ« branches.js (type, maintenanceCenterId, new endpoints)
10. âœ… ØªØ­Ø¯ÙŠØ« client.ts Ù…Ø¹ APIs Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ÙØ±ÙˆØ¹
11. âœ… ØªØ·Ø¨ÙŠÙ‚ permissions Ø¹Ù„Ù‰ routes (customers, requests, inventory, dashboard)
12. âœ… Frontend permissions.ts (role management)
13. âœ… ØªØ­Ø¯ÙŠØ« Layout.tsx (role-based menu filtering)
14. âœ… ØªØ­Ø³ÙŠÙ†Ø§Øª Ø«Ø¨Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (WAL Mode, Backup Script, Health Check)
15. âœ… Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙØ±ÙˆØ¹ (Branch Isolation)
16. âœ… Ù†Ø¸Ø§Ù… Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØªØªØ¨Ø¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ù„ÙƒÙ„ ÙØ±Ø¹ (Audit Logs)
17. âœ… Ø¥ØµÙ„Ø§Ø­ Ø¹Ù„Ø§Ù‚Ø§Øª `MachineSale` Ùˆ `Installment` Ù…Ø¹ Ø§Ù„ÙØ±ÙˆØ¹
18. âœ… Ø¥ØµÙ„Ø§Ø­ Ø®Ø·Ø£ 403 ÙÙŠ Ø±ÙØ¶ ÙˆØ§Ø³ØªÙ„Ø§Ù… ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
19. âœ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ© ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… ÙˆÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬
20. âœ… Ø¥Ø¹Ø§Ø¯Ø© Ù‡ÙŠÙƒÙ„Ø© Ø¯ÙˆØ±Ø© ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Phase 4)
21. âœ… ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© (Executive Analytics Dashboard)
22. âœ… Ø¥ØµÙ„Ø§Ø­ Ø¯Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· (rounding logic)
23. âœ… Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ ÙˆØªØ¹Ø¯ÙŠÙ„Ù‡ Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©

### ğŸ”„ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°:
1. Ø¥Ø¹Ø§Ø¯Ø© Ù‡ÙŠÙƒÙ„Ø© Ø¯ÙˆØ±Ø© Ø¹Ù…Ù„ Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© (Service Center Workflow Redesign)
   - ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø®ØªØµÙŠÙ† Ù„Ù„Ù…Ø§ÙƒÙŠÙ†Ø§Øª
   - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ù„Ù„Ù‚Ø·Ø¹ Ø¨Ù…Ù‚Ø§Ø¨Ù„
   - Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ù…Ù† Ø§Ù„ÙØ±Ø¹
   - Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©

### ğŸ“‹ Ù…Ø®Ø·Ø· (Roadmap):
1. Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ **PostgreSQL** ÙˆØ§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ (Cloud Deployment) - *Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ø¬Ø§Ù‡Ø²Ø©*
2. ØªÙ†ÙÙŠØ° Ø¯ÙˆØ±Ø© Ø¹Ù…Ù„ Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø© (Ø±Ø§Ø¬Ø¹: [MAINTENANCE_WORKFLOW.md](./MAINTENANCE_WORKFLOW.md))

---

## 9. Ø³Ø¬Ù„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª (Changelog)

| Ø§Ù„ØªØ§Ø±ÙŠØ® | Ø§Ù„ØªØºÙŠÙŠØ± |
|---------|---------|
| 2024-12-24 | Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„Ù„Ù†Ø¸Ø§Ù… |
| 2024-12-24 | Ø¥Ø¶Ø§ÙØ© Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© |
| 2024-12-24 | ØªØ­Ø¯ÙŠØ« Ù„Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø®Ù…Ø§Ø³ÙŠ (5-Screen Architecture) |
| 2024-12-24 | Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø³Ø¨Ø¹Ø© ÙˆÙ…ØµÙÙˆÙØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª |
| 2024-12-24 | ØªÙˆØ«ÙŠÙ‚ Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„ÙØ±Ø¹ Ø¨Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© |
| 2025-12-25 | ØªØ«Ø¨ÙŠØª Ø¹Ø²Ù„ Ø§Ù„ÙØ±ÙˆØ¹ (Branch Isolation) ÙˆØªÙƒØ§Ù…Ù„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… |
| 2025-12-26 | Ø¥Ø¹Ø§Ø¯Ø© Ù‡ÙŠÙƒÙ„Ø© ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØŒ ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© |
| 2025-12-26 | Ø¥ØµÙ„Ø§Ø­ Ø¯Ù‚Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØªØ®ØµÙŠØµ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø§Ù„Ø¯ÙˆØ± |
| 2025-12-31 | ØªØµÙ…ÙŠÙ… Ø¯ÙˆØ±Ø© Ø¹Ù…Ù„ Ù…Ø±ÙƒØ² Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© (6 Ù…Ø±Ø§Ø­Ù„) Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª |

## 3. Database Schema Overview

### 3.1 User
| Field | Type | Description |
|-------|------|-------------|
| id | String (UUID) | PK |
| email | String | Unique |
| role | String | SUPER_ADMIN, MANAGEMENT, ADMIN_AFFAIRS, CENTER_MANAGER, CENTER_TECH, BRANCH_MANAGER, TECHNICIAN |
| branchId | String? | FK to Branch |

### 3.2 Branch
| Field | Type | Description |
|-------|------|-------------|
| id | String (UUID) | PK |
| code | String | Unique Code (e.g. BR001, MC001) |
| name | String | Display Name |
| type | String | BRANCH, MAINTENANCE_CENTER, ADMIN_AFFAIRS |
| parentBranchId | String? | For hierarchical structure |
| maintenanceCenterId | String? | Link to Maintenance Center (if type=BRANCH) |

### 3.3 TransferOrder
| Field | Type | Description |
|-------|------|-------------|
| id | String (UUID) | PK |
| type | String | NEW_STOCK, SPARE_PARTS, ETC |
| status | String | PENDING, ACCEPTED, REJECTED |
| fromBranchId | String | Sender Branch FK |
| toBranchId | String | Receiver Branch FK |

### 3.4 Data Isolation & Traceability (Core Principle)
- **Isolation**: Every Branch (including `ADMIN_AFFAIRS`) has its own distinct data scope. This applies to Inventory, Customers, Sales, Payments, and Maintenance Requests.
- **Traceability**: Every action is logged in `SystemLog` with a `branchId`, ensuring a clear audit trail of which branch performed what action.
- **Stock Movement**: Admin Affairs introduces stock to *their own* warehouse or *directly* to a branch via "Transfer Orders" or direct assignment during Import.
- **Access Control**: `SUPER_ADMIN` and `MANAGEMENT` can view data across all branches, while branch-level roles are strictly restricted to their own `branchId`.

### 7. Dynamic Settings & Personalization

- **Permissions**: Admins can toggle page and action access per role via the UI.
- **Client Classification**: Categorize customers by type (Bakery, Pharmacy, etc.) for better reporting and targeting.
- **Visual Preferences**: Per-user theme (Light/Dark) and Arabic font selection. Preferences are persisted in the database and applied dynamically.
- **Executive Dashboard**: `SUPER_ADMIN` has access to a system-wide high-level summary including all branches, recent audit logs, and system health.
