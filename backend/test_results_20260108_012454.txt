======================================================== 
 SMART ENTERPRISE SUITE - BACKEND TEST REPORT 
 Timestamp: 20260108_012454 
======================================================== 
 
[1/3] Running General Integration Tests (integration.test.js)... 
-------------------------------------------------------- 
  console.log
    [MetricsCache] Initializing metrics cache...

      at Object.log [as initializeCache] (services/metricsCache.js:308:17)

  console.log
    [MetricsCache] Starting metrics calculation...

      at log (services/metricsCache.js:50:13)

{"level":30,"time":"2026-01-07T23:25:00.045Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","context":"Prisma","msg":"Starting a sqlite pool with 9 connections."}
  console.log
    [MetricsCache] Starting metrics calculation...

      at Object.log [as calculateAllMetrics] (services/metricsCache.js:50:13)

{"level":30,"time":"2026-01-07T23:25:00.112Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","req":{"id":2,"method":"GET","url":"/api/dashboard","query":{},"params":{},"headers":{"host":"127.0.0.1:59241","accept-encoding":"gzip, deflate","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":59242},"res":{"statusCode":200,"headers":{"content-security-policy":"default-src 'self';script-src 'self' 'unsafe-inline';style-src 'self' 'unsafe-inline';img-src 'self' data: https:;connect-src 'self';font-src 'self';object-src 'none';media-src 'self';frame-src 'self';base-uri 'self';form-action 'self';frame-ancestors 'self';script-src-attr 'none';upgrade-insecure-requests","cross-origin-embedder-policy":"require-corp","cross-origin-opener-policy":"same-origin","cross-origin-resource-policy":"cross-origin","origin-agent-cluster":"?1","referrer-policy":"strict-origin-when-cross-origin","strict-transport-security":"max-age=31536000; includeSubDomains; preload","x-content-type-options":"nosniff","x-dns-prefetch-control":"off","x-download-options":"noopen","x-frame-options":"DENY","x-permitted-cross-domain-policies":"none","x-xss-protection":"0","vary":"Origin","access-control-allow-credentials":"true","ratelimit-policy":"100;w=900","ratelimit-limit":"100","ratelimit-remaining":"99","ratelimit-reset":"900","content-type":"application/json; charset=utf-8","content-length":"312","etag":"W/\"138-3ioUDngPhLxTFcjyYslZGs1wJl4\""}},"responseTime":14,"msg":"GET / 200"}
  console.log
    [MetricsCache] Metrics calculated in 68ms

      at Object.log [as calculateAllMetrics] (services/metricsCache.js:230:17)

  console.log
    [MetricsCache] Metrics calculated in 216ms

      at log (services/metricsCache.js:230:17)

  console.log
    [MetricsCache] Cache initialized successfully

      at Object.log [as initializeCache] (services/metricsCache.js:310:17)

{"level":30,"time":"2026-01-07T23:25:00.132Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","req":{"id":3,"method":"GET","url":"/api/machines","query":{},"params":{},"headers":{"host":"127.0.0.1:59243","accept-encoding":"gzip, deflate","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":59244},"res":{"statusCode":200,"headers":{"content-security-policy":"default-src 'self';script-src 'self' 'unsafe-inline';style-src 'self' 'unsafe-inline';img-src 'self' data: https:;connect-src 'self';font-src 'self';object-src 'none';media-src 'self';frame-src 'self';base-uri 'self';form-action 'self';frame-ancestors 'self';script-src-attr 'none';upgrade-insecure-requests","cross-origin-embedder-policy":"require-corp","cross-origin-opener-policy":"same-origin","cross-origin-resource-policy":"cross-origin","origin-agent-cluster":"?1","referrer-policy":"strict-origin-when-cross-origin","strict-transport-security":"max-age=31536000; includeSubDomains; preload","x-content-type-options":"nosniff","x-dns-prefetch-control":"off","x-download-options":"noopen","x-frame-options":"DENY","x-permitted-cross-domain-policies":"none","x-xss-protection":"0","vary":"Origin","access-control-allow-credentials":"true","ratelimit-policy":"100;w=900","ratelimit-limit":"100","ratelimit-remaining":"98","ratelimit-reset":"900","content-type":"application/json; charset=utf-8","content-length":"2","etag":"W/\"2-l9Fw4VUO7kr8CvBlt4zaMCqXZ0w\""}},"responseTime":4,"msg":"GET /machines 200"}
{"level":30,"time":"2026-01-07T23:25:00.148Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","req":{"id":4,"method":"GET","url":"/api/customers/lite","query":{},"params":{},"headers":{"host":"127.0.0.1:59245","accept-encoding":"gzip, deflate","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":59246},"res":{"statusCode":200,"headers":{"content-security-policy":"default-src 'self';script-src 'self' 'unsafe-inline';style-src 'self' 'unsafe-inline';img-src 'self' data: https:;connect-src 'self';font-src 'self';object-src 'none';media-src 'self';frame-src 'self';base-uri 'self';form-action 'self';frame-ancestors 'self';script-src-attr 'none';upgrade-insecure-requests","cross-origin-embedder-policy":"require-corp","cross-origin-opener-policy":"same-origin","cross-origin-resource-policy":"cross-origin","origin-agent-cluster":"?1","referrer-policy":"strict-origin-when-cross-origin","strict-transport-security":"max-age=31536000; includeSubDomains; preload","x-content-type-options":"nosniff","x-dns-prefetch-control":"off","x-download-options":"noopen","x-frame-options":"DENY","x-permitted-cross-domain-policies":"none","x-xss-protection":"0","vary":"Origin","access-control-allow-credentials":"true","ratelimit-policy":"100;w=900","ratelimit-limit":"100","ratelimit-remaining":"97","ratelimit-reset":"900","content-type":"application/json; charset=utf-8","content-length":"2","etag":"W/\"2-l9Fw4VUO7kr8CvBlt4zaMCqXZ0w\""}},"responseTime":6,"msg":"GET /lite 200"}
{"level":50,"time":"2026-01-07T23:25:00.178Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","context":"Prisma","err":{"type":"Object","message":"\nInvalid `db.user.findMany()` invocation in\nC:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:37\n\n  43 }\n  44 \n  45 // Fetch technicians\nâ†’ 46 const technicians = await db.user.findMany({\n       where: {\n         canDoMaintenance: true\n       },\n       select: {\n         id: true,\n         displayName: true,\n         email: true,\n         role: true,\n         branchId: true,\n         phoneNumber: true,\n         ~~~~~~~~~~~\n     ?   uid?: true,\n     ?   canDoMaintenance?: true,\n     ?   password?: true,\n     ?   theme?: true,\n     ?   fontFamily?: true,\n     ?   fontSize?: true,\n     ?   highlightEffect?: true,\n     ?   notificationSound?: true,\n     ?   mobilePush?: true,\n     ?   createdAt?: true,\n     ?   branch?: true\n       },\n       orderBy: {\n         displayName: \"asc\"\n       }\n     })\n\nUnknown field `phoneNumber` for select statement on model `User`. Available options are marked with ?.","stack":"","target":"user.findMany","timestamp":"2026-01-07T23:25:00.178Z"},"msg":"\nInvalid `db.user.findMany()` invocation in\nC:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:37\n\n  43 }\n  44 \n  45 // Fetch technicians\nâ†’ 46 const technicians = await db.user.findMany({\n       where: {\n         canDoMaintenance: true\n       },\n       select: {\n         id: true,\n         displayName: true,\n         email: true,\n         role: true,\n         branchId: true,\n         phoneNumber: true,\n         ~~~~~~~~~~~\n     ?   uid?: true,\n     ?   canDoMaintenance?: true,\n     ?   password?: true,\n     ?   theme?: true,\n     ?   fontFamily?: true,\n     ?   fontSize?: true,\n     ?   highlightEffect?: true,\n     ?   notificationSound?: true,\n     ?   mobilePush?: true,\n     ?   createdAt?: true,\n     ?   branch?: true\n       },\n       orderBy: {\n         displayName: \"asc\"\n       }\n     })\n\nUnknown field `phoneNumber` for select statement on model `User`. Available options are marked with ?."}
{"level":50,"time":"2026-01-07T23:25:00.179Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","error":"\nInvalid `db.user.findMany()` invocation in\nC:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:37\n\n  43 }\n  44 \n  45 // Fetch technicians\nâ†’ 46 const technicians = await db.user.findMany({\n       where: {\n         canDoMaintenance: true\n       },\n       select: {\n         id: true,\n         displayName: true,\n         email: true,\n         role: true,\n         branchId: true,\n         phoneNumber: true,\n         ~~~~~~~~~~~\n     ?   uid?: true,\n     ?   canDoMaintenance?: true,\n     ?   password?: true,\n     ?   theme?: true,\n     ?   fontFamily?: true,\n     ?   fontSize?: true,\n     ?   highlightEffect?: true,\n     ?   notificationSound?: true,\n     ?   mobilePush?: true,\n     ?   createdAt?: true,\n     ?   branch?: true\n       },\n       orderBy: {\n         displayName: \"asc\"\n       }\n     })\n\nUnknown field `phoneNumber` for select statement on model `User`. Available options are marked with ?.","stack":"PrismaClientValidationError: \nInvalid `db.user.findMany()` invocation in\nC:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:37\n\n  43 }\n  44 \n  45 // Fetch technicians\nâ†’ 46 const technicians = await db.user.findMany({\n       where: {\n         canDoMaintenance: true\n       },\n       select: {\n         id: true,\n         displayName: true,\n         email: true,\n         role: true,\n         branchId: true,\n         phoneNumber: true,\n         ~~~~~~~~~~~\n     ?   uid?: true,\n     ?   canDoMaintenance?: true,\n     ?   password?: true,\n     ?   theme?: true,\n     ?   fontFamily?: true,\n     ?   fontSize?: true,\n     ?   highlightEffect?: true,\n     ?   notificationSound?: true,\n     ?   mobilePush?: true,\n     ?   createdAt?: true,\n     ?   branch?: true\n       },\n       orderBy: {\n         displayName: \"asc\"\n       }\n     })\n\nUnknown field `phoneNumber` for select statement on model `User`. Available options are marked with ?.\n    at wn (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:29:1363)\n    at $n.handleRequestError (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:121:6958)\n    at $n.handleAndLogRequestError (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:121:6623)\n    at $n.request (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:121:6307)\n    at l (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:130:9633)\n    at C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:23","path":"/","method":"GET","userId":"test-admin-id","msg":"Unhandled async error"}
{"level":50,"time":"2026-01-07T23:25:00.182Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","code":"INTERNAL_ERROR","message":"\nInvalid `db.user.findMany()` invocation in\nC:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:37\n\n  43 }\n  44 \n  45 // Fetch technicians\nâ†’ 46 const technicians = await db.user.findMany({\n       where: {\n         canDoMaintenance: true\n       },\n       select: {\n         id: true,\n         displayName: true,\n         email: true,\n         role: true,\n         branchId: true,\n         phoneNumber: true,\n         ~~~~~~~~~~~\n     ?   uid?: true,\n     ?   canDoMaintenance?: true,\n     ?   password?: true,\n     ?   theme?: true,\n     ?   fontFamily?: true,\n     ?   fontSize?: true,\n     ?   highlightEffect?: true,\n     ?   notificationSound?: true,\n     ?   mobilePush?: true,\n     ?   createdAt?: true,\n     ?   branch?: true\n       },\n       orderBy: {\n         displayName: \"asc\"\n       }\n     })\n\nUnknown field `phoneNumber` for select statement on model `User`. Available options are marked with ?.","statusCode":500,"path":"/api/technicians","method":"GET","userId":"test-admin-id","userRole":"SUPER_ADMIN","ip":"::ffff:127.0.0.1","timestamp":"2026-01-07T23:25:00.182Z","err":{"type":"PrismaClientValidationError","message":"\nInvalid `db.user.findMany()` invocation in\nC:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:37\n\n  43 }\n  44 \n  45 // Fetch technicians\nâ†’ 46 const technicians = await db.user.findMany({\n       where: {\n         canDoMaintenance: true\n       },\n       select: {\n         id: true,\n         displayName: true,\n         email: true,\n         role: true,\n         branchId: true,\n         phoneNumber: true,\n         ~~~~~~~~~~~\n     ?   uid?: true,\n     ?   canDoMaintenance?: true,\n     ?   password?: true,\n     ?   theme?: true,\n     ?   fontFamily?: true,\n     ?   fontSize?: true,\n     ?   highlightEffect?: true,\n     ?   notificationSound?: true,\n     ?   mobilePush?: true,\n     ?   createdAt?: true,\n     ?   branch?: true\n       },\n       orderBy: {\n         displayName: \"asc\"\n       }\n     })\n\nUnknown field `phoneNumber` for select statement on model `User`. Available options are marked with ?.","stack":"PrismaClientValidationError: \nInvalid `db.user.findMany()` invocation in\nC:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:37\n\n  43 }\n  44 \n  45 // Fetch technicians\nâ†’ 46 const technicians = await db.user.findMany({\n       where: {\n         canDoMaintenance: true\n       },\n       select: {\n         id: true,\n         displayName: true,\n         email: true,\n         role: true,\n         branchId: true,\n         phoneNumber: true,\n         ~~~~~~~~~~~\n     ?   uid?: true,\n     ?   canDoMaintenance?: true,\n     ?   password?: true,\n     ?   theme?: true,\n     ?   fontFamily?: true,\n     ?   fontSize?: true,\n     ?   highlightEffect?: true,\n     ?   notificationSound?: true,\n     ?   mobilePush?: true,\n     ?   createdAt?: true,\n     ?   branch?: true\n       },\n       orderBy: {\n         displayName: \"asc\"\n       }\n     })\n\nUnknown field `phoneNumber` for select statement on model `User`. Available options are marked with ?.\n    at wn (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:29:1363)\n    at $n.handleRequestError (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:121:6958)\n    at $n.handleAndLogRequestError (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:121:6623)\n    at $n.request (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:121:6307)\n    at l (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\@prisma\\client\\runtime\\library.js:130:9633)\n    at C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:23","name":"PrismaClientValidationError","clientVersion":"5.22.0"},"msg":"Server error"}
{"level":50,"time":"2026-01-07T23:25:00.187Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","req":{"id":5,"method":"GET","url":"/api/technicians","query":{},"params":{},"headers":{"host":"127.0.0.1:59247","accept-encoding":"gzip, deflate","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":59248},"res":{"statusCode":500,"headers":{"content-security-policy":"default-src 'self';script-src 'self' 'unsafe-inline';style-src 'self' 'unsafe-inline';img-src 'self' data: https:;connect-src 'self';font-src 'self';object-src 'none';media-src 'self';frame-src 'self';base-uri 'self';form-action 'self';frame-ancestors 'self';script-src-attr 'none';upgrade-insecure-requests","cross-origin-embedder-policy":"require-corp","cross-origin-opener-policy":"same-origin","cross-origin-resource-policy":"cross-origin","origin-agent-cluster":"?1","referrer-policy":"strict-origin-when-cross-origin","strict-transport-security":"max-age=31536000; includeSubDomains; preload","x-content-type-options":"nosniff","x-dns-prefetch-control":"off","x-download-options":"noopen","x-frame-options":"DENY","x-permitted-cross-domain-policies":"none","x-xss-protection":"0","vary":"Origin","access-control-allow-credentials":"true","ratelimit-policy":"100;w=900","ratelimit-limit":"100","ratelimit-remaining":"96","ratelimit-reset":"900","content-type":"application/json; charset=utf-8","content-length":"1092","etag":"W/\"444-IoFsYWjLCLU6FkzMfz3GkGiHEVQ\""}},"err":{"type":"Error","message":"failed with status code 500","stack":"Error: failed with status code 500\n    at onResFinished (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\pino-http\\logger.js:114:39)\n    at ServerResponse.onResponseComplete (C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\node_modules\\pino-http\\logger.js:177:14)\n    at ServerResponse.emit (node:events:530:35)\n    at onFinish (node:_http_outgoing:1082:10)\n    at callback (node:internal/streams/writable:766:21)\n    at afterWrite (node:internal/streams/writable:710:5)\n    at afterWriteTick (node:internal/streams/writable:696:10)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"},"responseTime":26,"msg":"GET /api/technicians 500 - failed with status code 500"}
  console.error
    Technicians Error: {
      error: {
        message: '\n' +
          'Invalid `db.user.findMany()` invocation in\n' +
          'C:\\Users\\mkame\\OneDrive\\Documents\\GitHub\\Smart-Enterprise-Suite_VS\\backend\\routes\\technicians.js:46:37\n' +
          '\n' +
          '  43 }\n' +
          '  44 \n' +
          '  45 // Fetch technicians\n' +
          'â†’ 46 const technicians = await db.user.findMany({\n' +
          '       where: {\n' +
          '         canDoMaintenance: true\n' +
          '       },\n' +
          '       select: {\n' +
          '         id: true,\n' +
          '         displayName: true,\n' +
          '         email: true,\n' +
          '         role: true,\n' +
          '         branchId: true,\n' +
          '         phoneNumber: true,\n' +
          '         ~~~~~~~~~~~\n' +
          '     ?   uid?: true,\n' +
          '     ?   canDoMaintenance?: true,\n' +
          '     ?   password?: true,\n' +
          '     ?   theme?: true,\n' +
          '     ?   fontFamily?: true,\n' +
          '     ?   fontSize?: true,\n' +
          '     ?   highlightEffect?: true,\n' +
          '     ?   notificationSound?: true,\n' +
          '     ?   mobilePush?: true,\n' +
          '     ?   createdAt?: true,\n' +
          '     ?   branch?: true\n' +
          '       },\n' +
          '       orderBy: {\n' +
          '         displayName: "asc"\n' +
          '       }\n' +
          '     })\n' +
          '\n' +
          'Unknown field `phoneNumber` for select statement on model `User`. Available options are marked with ?.',
        code: 'INTERNAL_ERROR',
        timestamp: '2026-01-07T23:25:00.182Z'
      }
    }

    [0m [90m 79 |[39m     test([32m'GET /api/technicians returns list'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m 80 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m'/api/technicians'[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 81 |[39m         [36mif[39m (res[33m.[39mstatusCode [33m!==[39m [35m200[39m) console[33m.[39merror([32m'Technicians Error:'[39m[33m,[39m res[33m.[39mbody)[33m;[39m
     [90m    |[39m                                             [31m[1m^[22m[39m
     [90m 82 |[39m         expect(res[33m.[39mstatusCode)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m 83 |[39m         expect([33mArray[39m[33m.[39misArray(res[33m.[39mbody))[33m.[39mtoBeTruthy()[33m;[39m
     [90m 84 |[39m     })[33m;[39m[0m

      at Object.error (tests/integration.test.js:81:45)

{"level":30,"time":"2026-01-07T23:25:00.211Z","name":"cs-dept-console","pid":17772,"hostname":"MKamel","env":"test","req":{"id":6,"method":"GET","url":"/api/machine-workflow/kanban","query":{},"params":{},"headers":{"host":"127.0.0.1:59249","accept-encoding":"gzip, deflate","connection":"close"},"remoteAddress":"::ffff:127.0.0.1","remotePort":59250},"res":{"statusCode":200,"headers":{"content-security-policy":"default-src 'self';script-src 'self' 'unsafe-inline';style-src 'self' 'unsafe-inline';img-src 'self' data: https:;connect-src 'self';font-src 'self';object-src 'none';media-src 'self';frame-src 'self';base-uri 'self';form-action 'self';frame-ancestors 'self';script-src-attr 'none';upgrade-insecure-requests","cross-origin-embedder-policy":"require-corp","cross-origin-opener-policy":"same-origin","cross-origin-resource-policy":"cross-origin","origin-agent-cluster":"?1","referrer-policy":"strict-origin-when-cross-origin","strict-transport-security":"max-age=31536000; includeSubDomains; preload","x-content-type-options":"nosniff","x-dns-prefetch-control":"off","x-download-options":"noopen","x-frame-options":"DENY","x-permitted-cross-domain-policies":"none","x-xss-protection":"0","vary":"Origin","access-control-allow-credentials":"true","ratelimit-policy":"100;w=900","ratelimit-limit":"100","ratelimit-remaining":"95","ratelimit-reset":"900","content-type":"application/json; charset=utf-8","content-length":"2","etag":"W/\"2-l9Fw4VUO7kr8CvBlt4zaMCqXZ0w\""}},"responseTime":5,"msg":"GET /kanban 200"}
FAIL tests/integration.test.js
  Backend Integration API
    âˆš GET /health returns 200 (100 ms)
    âˆš GET /api/dashboard returns structured data (34 ms)
    âˆš GET /api/machines returns array (18 ms)
    âˆš GET /api/customers/lite returns simplified list (18 ms)
    Ã— GET /api/technicians returns list (45 ms)
    âˆš GET /api/machine-workflow/kanban returns board data (14 ms)

  â— Backend Integration API â€º GET /api/technicians returns list

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 80 |[39m         [36mconst[39m res [33m=[39m [36mawait[39m request(app)[33m.[39m[36mget[39m([32m'/api/technicians'[39m)[33m;[39m
     [90m 81 |[39m         [36mif[39m (res[33m.[39mstatusCode [33m!==[39m [35m200[39m) console[33m.[39merror([32m'Technicians Error:'[39m[33m,[39m res[33m.[39mbody)[33m;[39m
    [31m[1m>[22m[39m[90m 82 |[39m         expect(res[33m.[39mstatusCode)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m    |[39m                                [31m[1m^[22m[39m
     [90m 83 |[39m         expect([33mArray[39m[33m.[39misArray(res[33m.[39mbody))[33m.[39mtoBeTruthy()[33m;[39m
     [90m 84 |[39m     })[33m;[39m
     [90m 85 |[39m[0m

      at Object.toBe (tests/integration.test.js:82:32)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 5 passed, 6 total
Snapshots:   0 total
Time:        4.017 s
Ran all test suites matching tests/integration.test.js.

Jest has detected the following 1 open handle potentially keeping Jest from exiting:

  â—  Timeout

    [0m [90m 317 |[39m
     [90m 318 |[39m [90m// Refresh metrics cache every 5 minutes[39m
    [31m[1m>[22m[39m[90m 319 |[39m cron[33m.[39mschedule([32m'*/5 * * * *'[39m[33m,[39m [36masync[39m () [33m=>[39m {
     [90m     |[39m      [31m[1m^[22m[39m
     [90m 320 |[39m   logger[33m.[39mdebug([32m'Refreshing metrics cache...'[39m)[33m;[39m
     [90m 321 |[39m   [36mtry[39m {
     [90m 322 |[39m     [36mawait[39m metricsCache[33m.[39mcalculateAllMetrics()[33m;[39m[0m

      at Runner.start (node_modules/node-cron/src/scheduler/runner.ts:167:29)
      at InlineScheduledTask.start (node_modules/node-cron/src/tasks/inline-scheduled-task.ts:89:19)
      at Object.schedule (node_modules/node-cron/src/node-cron.ts:46:10)
      at Object.schedule (server.js:319:6)
      at Object.require (tests/integration.test.js:21:17)

  FAIL 
 
[2/3] Running Transfer Service Tests (transferService.test.js)... 
-------------------------------------------------------- 
FAIL tests/transferService.test.js
  â— Test suite failed to run

    Jest encountered an unexpected token

    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.

    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.

    By default "node_modules" folder is ignored by transformers.

    Here's what you can do:
     â€¢ If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.
     â€¢ If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript
     â€¢ To have some of your "node_modules" files transformed, you can specify a custom "transformIgnorePatterns" in your config.
     â€¢ If you need a custom transformation, specify a "transform" option in your config.
     â€¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the "moduleNameMapper" config option.

    You'll find more details and examples of these config options in the docs:
    https://jestjs.io/docs/configuration
    For information about custom transformations, see:
    https://jestjs.io/docs/code-transformation

    Details:

    SyntaxError: C:\Users\mkame\OneDrive\Documents\GitHub\Smart-Enterprise-Suite_VS\backend\tests\transferService.test.js: Identifier 'error' has already been declared. (138:18)

    [0m [90m 136 |[39m             [36mconst[39m error [33m=[39m [36mnew[39m [33mError[39m([32m'Database error'[39m)[33m;[39m
     [90m 137 |[39m
    [31m[1m>[22m[39m[90m 138 |[39m             [36mconst[39m error [33m=[39m [36mnew[39m [33mError[39m([32m'Database error'[39m)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 139 |[39m
     [90m 140 |[39m             [90m// Validation must pass first[39m
     [90m 141 |[39m             db[33m.[39mbranch[33m.[39mfindUnique[33m.[39mmockResolvedValue({ id[33m:[39m [32m'branchA'[39m[33m,[39m isActive[33m:[39m [36mtrue[39m[33m,[39m type[33m:[39m [32m'BRANCH'[39m })[33m;[39m[0m

      at constructor (node_modules/@babel/parser/src/parse-error.ts:95:45)
      at Parser.toParseError [as raise] (node_modules/@babel/parser/src/tokenizer/index.ts:1507:19)
      at ScopeHandler.raise [as checkRedeclarationInScope] (node_modules/@babel/parser/src/util/scope.ts:164:19)
      at ScopeHandler.checkRedeclarationInScope [as declareName] (node_modules/@babel/parser/src/util/scope.ts:118:12)
      at Parser.declareName [as declareNameFromIdentifier] (node_modules/@babel/parser/src/parser/lval.ts:852:16)
      at Parser.declareNameFromIdentifier [as checkIdentifier] (node_modules/@babel/parser/src/parser/lval.ts:847:12)
      at Parser.checkIdentifier [as checkLVal] (node_modules/@babel/parser/src/parser/lval.ts:739:12)
      at Parser.checkLVal [as parseVarId] (node_modules/@babel/parser/src/parser/statement.ts:1633:10)
      at Parser.parseVarId [as parseVar] (node_modules/@babel/parser/src/parser/statement.ts:1582:12)
      at Parser.parseVar [as parseVarStatement] (node_modules/@babel/parser/src/parser/statement.ts:1251:10)
      at Parser.parseVarStatement [as parseStatementContent] (node_modules/@babel/parser/src/parser/statement.ts:612:21)
      at Parser.parseStatementContent [as parseStatementLike] (node_modules/@babel/parser/src/parser/statement.ts:482:17)
      at Parser.parseStatementLike [as parseStatementListItem] (node_modules/@babel/parser/src/parser/statement.ts:431:17)
      at Parser.parseStatementListItem [as parseBlockOrModuleBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1444:16)
      at Parser.parseBlockOrModuleBlockBody [as parseBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1417:10)
      at Parser.parseBlockBody [as parseBlock] (node_modules/@babel/parser/src/parser/statement.ts:1385:10)
      at Parser.parseBlock [as parseFunctionBody] (node_modules/@babel/parser/src/parser/expression.ts:2626:24)
      at Parser.parseFunctionBody [as parseArrowExpression] (node_modules/@babel/parser/src/parser/expression.ts:2563:10)
      at Parser.parseArrowExpression [as parseAsyncArrowFromCallExpression] (node_modules/@babel/parser/src/parser/expression.ts:1067:10)
      at Parser.parseAsyncArrowFromCallExpression [as parseCoverCallAndAsyncArrowHead] (node_modules/@babel/parser/src/parser/expression.ts:942:27)
      at Parser.parseCoverCallAndAsyncArrowHead [as parseSubscript] (node_modules/@babel/parser/src/parser/expression.ts:804:19)
      at Parser.parseSubscript [as parseSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:763:19)
      at Parser.parseSubscripts [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:748:17)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)
      at Parser.parseMaybeUnaryOrPrivate [as parseExprOps] (node_modules/@babel/parser/src/parser/expression.ts:429:23)
      at Parser.parseExprOps [as parseMaybeConditional] (node_modules/@babel/parser/src/parser/expression.ts:384:23)
      at Parser.parseMaybeConditional [as parseMaybeAssign] (node_modules/@babel/parser/src/parser/expression.ts:301:21)
      at parseMaybeAssign (node_modules/@babel/parser/src/parser/expression.ts:257:12)
      at Parser.callback [as allowInAnd] (node_modules/@babel/parser/src/parser/expression.ts:3202:12)
      at Parser.allowInAnd [as parseMaybeAssignAllowIn] (node_modules/@babel/parser/src/parser/expression.ts:256:17)
      at Parser.parseMaybeAssignAllowIn [as parseMaybeAssignAllowInOrVoidPattern] (node_modules/@babel/parser/src/parser/expression.ts:3316:17)
      at Parser.parseMaybeAssignAllowInOrVoidPattern [as parseExprListItem] (node_modules/@babel/parser/src/parser/expression.ts:2798:18)
      at Parser.parseExprListItem [as parseCallExpressionArguments] (node_modules/@babel/parser/src/parser/expression.ts:1042:14)
      at Parser.parseCallExpressionArguments [as parseCoverCallAndAsyncArrowHead] (node_modules/@babel/parser/src/parser/expression.ts:922:29)
      at Parser.parseCoverCallAndAsyncArrowHead [as parseSubscript] (node_modules/@babel/parser/src/parser/expression.ts:804:19)
      at Parser.parseSubscript [as parseSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:763:19)
      at Parser.parseSubscripts [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:748:17)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)
      at Parser.parseMaybeUnaryOrPrivate [as parseExprOps] (node_modules/@babel/parser/src/parser/expression.ts:429:23)
      at Parser.parseExprOps [as parseMaybeConditional] (node_modules/@babel/parser/src/parser/expression.ts:384:23)
      at Parser.parseMaybeConditional [as parseMaybeAssign] (node_modules/@babel/parser/src/parser/expression.ts:301:21)
      at Parser.parseMaybeAssign [as parseExpressionBase] (node_modules/@babel/parser/src/parser/expression.ts:226:23)
      at parseExpressionBase (node_modules/@babel/parser/src/parser/expression.ts:217:39)
      at Parser.callback [as allowInAnd] (node_modules/@babel/parser/src/parser/expression.ts:3197:16)
      at Parser.allowInAnd [as parseExpression] (node_modules/@babel/parser/src/parser/expression.ts:217:17)
      at Parser.parseExpression [as parseStatementContent] (node_modules/@babel/parser/src/parser/statement.ts:688:23)
      at Parser.parseStatementContent [as parseStatementLike] (node_modules/@babel/parser/src/parser/statement.ts:482:17)
      at Parser.parseStatementLike [as parseStatementListItem] (node_modules/@babel/parser/src/parser/statement.ts:431:17)
      at Parser.parseStatementListItem [as parseBlockOrModuleBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1444:16)
      at Parser.parseBlockOrModuleBlockBody [as parseBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1417:10)
      at Parser.parseBlockBody [as parseBlock] (node_modules/@babel/parser/src/parser/statement.ts:1385:10)
      at Parser.parseBlock [as parseFunctionBody] (node_modules/@babel/parser/src/parser/expression.ts:2626:24)
      at Parser.parseFunctionBody [as parseArrowExpression] (node_modules/@babel/parser/src/parser/expression.ts:2563:10)
      at Parser.parseArrowExpression [as parseParenAndDistinguishExpression] (node_modules/@babel/parser/src/parser/expression.ts:1847:12)
      at Parser.parseParenAndDistinguishExpression [as parseExprAtom] (node_modules/@babel/parser/src/parser/expression.ts:1170:21)
      at Parser.parseExprAtom [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:742:23)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)
      at Parser.parseMaybeUnaryOrPrivate [as parseExprOps] (node_modules/@babel/parser/src/parser/expression.ts:429:23)
      at Parser.parseExprOps [as parseMaybeConditional] (node_modules/@babel/parser/src/parser/expression.ts:384:23)
      at Parser.parseMaybeConditional [as parseMaybeAssign] (node_modules/@babel/parser/src/parser/expression.ts:301:21)
      at parseMaybeAssign (node_modules/@babel/parser/src/parser/expression.ts:257:12)
      at Parser.callback [as allowInAnd] (node_modules/@babel/parser/src/parser/expression.ts:3202:12)
      at Parser.allowInAnd [as parseMaybeAssignAllowIn] (node_modules/@babel/parser/src/parser/expression.ts:256:17)
      at Parser.parseMaybeAssignAllowIn [as parseMaybeAssignAllowInOrVoidPattern] (node_modules/@babel/parser/src/parser/expression.ts:3316:17)
      at Parser.parseMaybeAssignAllowInOrVoidPattern [as parseExprListItem] (node_modules/@babel/parser/src/parser/expression.ts:2798:18)
      at Parser.parseExprListItem [as parseCallExpressionArguments] (node_modules/@babel/parser/src/parser/expression.ts:1042:14)
      at Parser.parseCallExpressionArguments [as parseCoverCallAndAsyncArrowHead] (node_modules/@babel/parser/src/parser/expression.ts:922:29)
      at Parser.parseCoverCallAndAsyncArrowHead [as parseSubscript] (node_modules/@babel/parser/src/parser/expression.ts:804:19)
      at Parser.parseSubscript [as parseSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:763:19)
      at Parser.parseSubscripts [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:748:17)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)
      at Parser.parseMaybeUnaryOrPrivate [as parseExprOps] (node_modules/@babel/parser/src/parser/expression.ts:429:23)
      at Parser.parseExprOps [as parseMaybeConditional] (node_modules/@babel/parser/src/parser/expression.ts:384:23)
      at Parser.parseMaybeConditional [as parseMaybeAssign] (node_modules/@babel/parser/src/parser/expression.ts:301:21)
      at Parser.parseMaybeAssign [as parseExpressionBase] (node_modules/@babel/parser/src/parser/expression.ts:226:23)
      at parseExpressionBase (node_modules/@babel/parser/src/parser/expression.ts:217:39)
      at Parser.callback [as allowInAnd] (node_modules/@babel/parser/src/parser/expression.ts:3197:16)
      at Parser.allowInAnd [as parseExpression] (node_modules/@babel/parser/src/parser/expression.ts:217:17)
      at Parser.parseExpression [as parseStatementContent] (node_modules/@babel/parser/src/parser/statement.ts:688:23)
      at Parser.parseStatementContent [as parseStatementLike] (node_modules/@babel/parser/src/parser/statement.ts:482:17)
      at Parser.parseStatementLike [as parseStatementListItem] (node_modules/@babel/parser/src/parser/statement.ts:431:17)
      at Parser.parseStatementListItem [as parseBlockOrModuleBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1444:16)
      at Parser.parseBlockOrModuleBlockBody [as parseBlockBody] (node_modules/@babel/parser/src/parser/statement.ts:1417:10)
      at Parser.parseBlockBody [as parseBlock] (node_modules/@babel/parser/src/parser/statement.ts:1385:10)
      at Parser.parseBlock [as parseFunctionBody] (node_modules/@babel/parser/src/parser/expression.ts:2626:24)
      at Parser.parseFunctionBody [as parseArrowExpression] (node_modules/@babel/parser/src/parser/expression.ts:2563:10)
      at Parser.parseArrowExpression [as parseParenAndDistinguishExpression] (node_modules/@babel/parser/src/parser/expression.ts:1847:12)
      at Parser.parseParenAndDistinguishExpression [as parseExprAtom] (node_modules/@babel/parser/src/parser/expression.ts:1170:21)
      at Parser.parseExprAtom [as parseExprSubscripts] (node_modules/@babel/parser/src/parser/expression.ts:742:23)
      at Parser.parseExprSubscripts [as parseUpdate] (node_modules/@babel/parser/src/parser/expression.ts:721:21)
      at Parser.parseUpdate [as parseMaybeUnary] (node_modules/@babel/parser/src/parser/expression.ts:683:23)
      at Parser.parseMaybeUnary [as parseMaybeUnaryOrPrivate] (node_modules/@babel/parser/src/parser/expression.ts:417:14)

Test Suites: 1 failed, 1 total
Tests:       0 total
Snapshots:   0 total
Time:        0.667 s, estimated 1 s
Ran all test suites matching tests/transferService.test.js.
  FAIL 
 
[3/3] Running Transfer Smoke Tests (transferService.smoke2.test.js)... 
-------------------------------------------------------- 
FAIL tests/transferService.smoke2.test.js
  transferService smoke flows
    Ã— creates a SIM transfer order (4 ms)
    âˆš imports from excel requires buffer (3 ms)

  â— transferService smoke flows â€º creates a SIM transfer order

    Ø¸Ù¾Ø·Â±Ø·Â¹ Ø·Â§Ø¸â€žØ¸â€¦Ø·ÂµØ·Â¯Ø·Â± Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€ Ø·Â´Ø·Â·
    Ø¸Ù¾Ø·Â±Ø·Â¹ Ø·Â§Ø¸â€žØ¸Ë†Ø·Â¬Ø¸â€¡Ø·Â© Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€ Ø·Â´Ø·Â·

    [0m [90m 69 |[39m
     [90m 70 |[39m     [36mif[39m ([33m![39mvalidation[33m.[39mvalid) {
    [31m[1m>[22m[39m[90m 71 |[39m         [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m(validation[33m.[39merrors[33m.[39mjoin([32m'\n'[39m))[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 72 |[39m         err[33m.[39mstatus [33m=[39m [35m400[39m[33m;[39m
     [90m 73 |[39m         [36mthrow[39m err[33m;[39m
     [90m 74 |[39m     }[0m

      at createTransferOrder (services/transferService.js:71:21)
      at Object.<anonymous> (tests/transferService.smoke2.test.js:24:23)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 passed, 2 total
Snapshots:   0 total
Time:        0.825 s, estimated 1 s
Ran all test suites matching tests/transferService.smoke2.test.js.
  FAIL 
 
======================================================== 
 TEST RUN COMPLETE 
======================================================== 
