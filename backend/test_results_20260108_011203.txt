======================================================== 
 SMART ENTERPRISE SUITE - BACKEND TEST REPORT 
 Timestamp: 20260108_011203 
======================================================== 
 
[1/3] Running General Integration Tests (integration.test.js)... 
-------------------------------------------------------- 
FAIL tests/integration.test.js
  â— Test suite failed to run

    Route.post() requires a callback function but got a [object Undefined]

    [0m [90m  96 |[39m
     [90m  97 |[39m [90m// POST create user (super admin only)[39m
    [31m[1m>[22m[39m[90m  98 |[39m router[33m.[39mpost([32m'/'[39m[33m,[39m authenticateToken[33m,[39m requireSuperAdmin[33m,[39m [36masync[39m (req[33m,[39m res) [33m=>[39m {
     [90m     |[39m        [31m[1m^[22m[39m
     [90m  99 |[39m     [36mtry[39m {
     [90m 100 |[39m         [36mconst[39m { email[33m,[39m displayName[33m,[39m password[33m,[39m role[33m,[39m branchId[33m,[39m canDoMaintenance } [33m=[39m req[33m.[39mbody[33m;[39m
     [90m 101 |[39m[0m

      at Route.<computed> [as post] (node_modules/express/lib/router/route.js:216:15)
      at Function.proto.<computed> [as post] (node_modules/express/lib/router/index.js:521:19)
      at Object.post (routes/users.js:98:8)
      at Object.require (server.js:172:23)
      at Object.require (tests/integration.test.js:20:17)

Test Suites: 1 failed, 1 total
Tests:       0 total
Snapshots:   0 total
Time:        1.952 s
Ran all test suites matching tests/integration.test.js.
  FAIL 
 
[2/3] Running Transfer Service Tests (transferService.test.js)... 
-------------------------------------------------------- 
FAIL tests/transferService.test.js
  transferService
    createTransferOrder
      Ã— should create a transfer order within a transaction (4 ms)
      Ã— should rollback if an error occurs during creation (17 ms)
    receiveTransferOrder
      Ã— should receive a transfer order within a transaction (2 ms)
      âˆš should throw if order not found (2 ms)
      Ã— should rollback if an error occurs during reception (10 ms)
    rejectOrder
      Ã— should reject a transfer order within a transaction (2 ms)
      âˆš should throw if order not found for rejection (2 ms)
      Ã— should rollback if an error occurs during rejection (5 ms)
    cancelOrder
      Ã— should cancel a transfer order within a transaction (2 ms)
      âˆš should throw if order not found for cancellation (1 ms)
      Ã— should rollback if an error occurs during cancellation (7 ms)

  â— transferService â€º createTransferOrder â€º should create a transfer order within a transaction

    Ø¸Ù¾Ø·Â±Ø·Â¹ Ø·Â§Ø¸â€žØ¸â€¦Ø·ÂµØ·Â¯Ø·Â± Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€ Ø·Â´Ø·Â·
    Ø¸Ù¾Ø·Â±Ø·Â¹ Ø·Â§Ø¸â€žØ¸Ë†Ø·Â¬Ø¸â€¡Ø·Â© Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€ Ø·Â´Ø·Â·

    [0m [90m 69 |[39m
     [90m 70 |[39m     [36mif[39m ([33m![39mvalidation[33m.[39mvalid) {
    [31m[1m>[22m[39m[90m 71 |[39m         [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m(validation[33m.[39merrors[33m.[39mjoin([32m'\n'[39m))[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 72 |[39m         err[33m.[39mstatus [33m=[39m [35m400[39m[33m;[39m
     [90m 73 |[39m         [36mthrow[39m err[33m;[39m
     [90m 74 |[39m     }[0m

      at createTransferOrder (services/transferService.js:71:21)
      at Object.<anonymous> (tests/transferService.test.js:93:28)

  â— transferService â€º createTransferOrder â€º should rollback if an error occurs during creation

    expect(received).rejects.toThrow(expected)

    Expected substring: "Database error"
    Received message:   "Ø¸Ù¾Ø·Â±Ø·Â¹ Ø·Â§Ø¸â€žØ¸â€¦Ø·ÂµØ·Â¯Ø·Â± Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€ Ø·Â´Ø·Â·
    Ø¸Ù¾Ø·Â±Ø·Â¹ Ø·Â§Ø¸â€žØ¸Ë†Ø·Â¬Ø¸â€¡Ø·Â© Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€ Ø·Â´Ø·Â·"

        [0m [90m 69 |[39m
         [90m 70 |[39m     [36mif[39m ([33m![39mvalidation[33m.[39mvalid) {
        [31m[1m>[22m[39m[90m 71 |[39m         [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m(validation[33m.[39merrors[33m.[39mjoin([32m'\n'[39m))[33m;[39m
         [90m    |[39m                     [31m[1m^[22m[39m
         [90m 72 |[39m         err[33m.[39mstatus [33m=[39m [35m400[39m[33m;[39m
         [90m 73 |[39m         [36mthrow[39m err[33m;[39m
         [90m 74 |[39m     }[0m

      at createTransferOrder (services/transferService.js:71:21)
      at Object.<anonymous> (tests/transferService.test.js:125:13)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (tests/transferService.test.js:125:80)

  â— transferService â€º receiveTransferOrder â€º should receive a transfer order within a transaction

    Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯

    [0m [90m 192 |[39m
     [90m 193 |[39m     [36mif[39m ([33m![39morder) {
    [31m[1m>[22m[39m[90m 194 |[39m         [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m([32m'Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯'[39m)[33m;[39m
     [90m     |[39m                     [31m[1m^[22m[39m
     [90m 195 |[39m         err[33m.[39mstatus [33m=[39m [35m404[39m[33m;[39m
     [90m 196 |[39m         [36mthrow[39m err[33m;[39m
     [90m 197 |[39m     }[0m

      at receiveTransferOrder (services/transferService.js:194:21)
      at Object.<anonymous> (tests/transferService.test.js:192:32)

  â— transferService â€º receiveTransferOrder â€º should rollback if an error occurs during reception

    expect(received).rejects.toThrow(expected)

    Expected substring: "DB update error"
    Received message:   "Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯"

        [0m [90m 192 |[39m
         [90m 193 |[39m     [36mif[39m ([33m![39morder) {
        [31m[1m>[22m[39m[90m 194 |[39m         [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m([32m'Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯'[39m)[33m;[39m
         [90m     |[39m                     [31m[1m^[22m[39m
         [90m 195 |[39m         err[33m.[39mstatus [33m=[39m [35m404[39m[33m;[39m
         [90m 196 |[39m         [36mthrow[39m err[33m;[39m
         [90m 197 |[39m     }[0m

      at receiveTransferOrder (services/transferService.js:194:21)
      at Object.<anonymous> (tests/transferService.test.js:223:13)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (tests/transferService.test.js:223:87)

  â— transferService â€º rejectOrder â€º should reject a transfer order within a transaction

    Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯

    [0m [90m 545 |[39m         })[33m;[39m
     [90m 546 |[39m     }
    [31m[1m>[22m[39m[90m 547 |[39m     [36mif[39m ([33m![39morder) { [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m([32m'Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯'[39m)[33m;[39m err[33m.[39mstatus [33m=[39m [35m404[39m[33m;[39m [36mthrow[39m err[33m;[39m }
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 548 |[39m     [36mif[39m (order[33m.[39mstatus [33m!==[39m [32m'PENDING'[39m) { [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m([32m'Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø¸â€žØ¸Ù¹Ø·Â³ Ø¸Ù¾Ø¸Ù¹ Ø·Â­Ø·Â§Ø¸â€žØ·Â© Ø·Â§Ø¸â€ Ø·Ú¾Ø·Â¸Ø·Â§Ø·Â±'[39m)[33m;[39m err[33m.[39mstatus [33m=[39m [35m400[39m[33m;[39m [36mthrow[39m err[33m;[39m }
     [90m 549 |[39m
     [90m 550 |[39m     [36mconst[39m orderWithItems [33m=[39m isAdmin [33m?[39m [36mawait[39m db[33m.[39mtransferOrder[33m.[39mfindFirst({[0m

      at rejectOrder (services/transferService.js:547:31)
      at Object.<anonymous> (tests/transferService.test.js:256:28)

  â— transferService â€º rejectOrder â€º should rollback if an error occurs during rejection

    expect(received).rejects.toThrow(expected)

    Expected substring: "Rejection DB error"
    Received message:   "Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯"

        [0m [90m 545 |[39m         })[33m;[39m
         [90m 546 |[39m     }
        [31m[1m>[22m[39m[90m 547 |[39m     [36mif[39m ([33m![39morder) { [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m([32m'Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯'[39m)[33m;[39m err[33m.[39mstatus [33m=[39m [35m404[39m[33m;[39m [36mthrow[39m err[33m;[39m }
         [90m     |[39m                               [31m[1m^[22m[39m
         [90m 548 |[39m     [36mif[39m (order[33m.[39mstatus [33m!==[39m [32m'PENDING'[39m) { [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m([32m'Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø¸â€žØ¸Ù¹Ø·Â³ Ø¸Ù¾Ø¸Ù¹ Ø·Â­Ø·Â§Ø¸â€žØ·Â© Ø·Â§Ø¸â€ Ø·Ú¾Ø·Â¸Ø·Â§Ø·Â±'[39m)[33m;[39m err[33m.[39mstatus [33m=[39m [35m400[39m[33m;[39m [36mthrow[39m err[33m;[39m }
         [90m 549 |[39m
         [90m 550 |[39m     [36mconst[39m orderWithItems [33m=[39m isAdmin [33m?[39m [36mawait[39m db[33m.[39mtransferOrder[33m.[39mfindFirst({[0m

      at rejectOrder (services/transferService.js:547:31)
      at Object.<anonymous> (tests/transferService.test.js:311:13)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (tests/transferService.test.js:311:78)

  â— transferService â€º cancelOrder â€º should cancel a transfer order within a transaction

    Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯

    [0m [90m 629 |[39m         })[33m;[39m
     [90m 630 |[39m     }
    [31m[1m>[22m[39m[90m 631 |[39m     [36mif[39m ([33m![39morder) { [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m([32m'Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯'[39m)[33m;[39m err[33m.[39mstatus [33m=[39m [35m404[39m[33m;[39m [36mthrow[39m err[33m;[39m }
     [90m     |[39m                               [31m[1m^[22m[39m
     [90m 632 |[39m     [36mconst[39m isCreator [33m=[39m user[33m.[39mid [33m===[39m order[33m.[39mcreatedByUserId[33m;[39m
     [90m 633 |[39m
     [90m 634 |[39m     [36mconst[39m isAdminOrAffairs [33m=[39m isAdmin[33m;[39m[0m

      at cancelOrder (services/transferService.js:631:31)
      at Object.<anonymous> (tests/transferService.test.js:345:13)

  â— transferService â€º cancelOrder â€º should rollback if an error occurs during cancellation

    expect(received).rejects.toThrow(expected)

    Expected substring: "Cancellation DB error"
    Received message:   "Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯"

        [0m [90m 629 |[39m         })[33m;[39m
         [90m 630 |[39m     }
        [31m[1m>[22m[39m[90m 631 |[39m     [36mif[39m ([33m![39morder) { [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m([32m'Ø·Â§Ø¸â€žØ·Â¥Ø·Â°Ø¸â€  Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€¦Ø¸Ë†Ø·Â¬Ø¸Ë†Ø·Â¯'[39m)[33m;[39m err[33m.[39mstatus [33m=[39m [35m404[39m[33m;[39m [36mthrow[39m err[33m;[39m }
         [90m     |[39m                               [31m[1m^[22m[39m
         [90m 632 |[39m     [36mconst[39m isCreator [33m=[39m user[33m.[39mid [33m===[39m order[33m.[39mcreatedByUserId[33m;[39m
         [90m 633 |[39m
         [90m 634 |[39m     [36mconst[39m isAdminOrAffairs [33m=[39m isAdmin[33m;[39m[0m

      at cancelOrder (services/transferService.js:631:31)
      at Object.<anonymous> (tests/transferService.test.js:419:13)
      at Object.toThrow (node_modules/expect/build/index.js:2155:20)
      at Object.toThrow (tests/transferService.test.js:419:74)

Test Suites: 1 failed, 1 total
Tests:       8 failed, 3 passed, 11 total
Snapshots:   0 total
Time:        0.814 s
Ran all test suites matching tests/transferService.test.js.
  FAIL 
 
[3/3] Running Transfer Smoke Tests (transferService.smoke2.test.js)... 
-------------------------------------------------------- 
FAIL tests/transferService.smoke2.test.js
  transferService smoke flows
    Ã— creates a SIM transfer order (5 ms)
    âˆš imports from excel requires buffer (3 ms)

  â— transferService smoke flows â€º creates a SIM transfer order

    Ø¸Ù¾Ø·Â±Ø·Â¹ Ø·Â§Ø¸â€žØ¸â€¦Ø·ÂµØ·Â¯Ø·Â± Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€ Ø·Â´Ø·Â·
    Ø¸Ù¾Ø·Â±Ø·Â¹ Ø·Â§Ø¸â€žØ¸Ë†Ø·Â¬Ø¸â€¡Ø·Â© Ø·Ø›Ø¸Ù¹Ø·Â± Ø¸â€ Ø·Â´Ø·Â·

    [0m [90m 69 |[39m
     [90m 70 |[39m     [36mif[39m ([33m![39mvalidation[33m.[39mvalid) {
    [31m[1m>[22m[39m[90m 71 |[39m         [36mconst[39m err [33m=[39m [36mnew[39m [33mError[39m(validation[33m.[39merrors[33m.[39mjoin([32m'\n'[39m))[33m;[39m
     [90m    |[39m                     [31m[1m^[22m[39m
     [90m 72 |[39m         err[33m.[39mstatus [33m=[39m [35m400[39m[33m;[39m
     [90m 73 |[39m         [36mthrow[39m err[33m;[39m
     [90m 74 |[39m     }[0m

      at createTransferOrder (services/transferService.js:71:21)
      at Object.<anonymous> (tests/transferService.smoke2.test.js:24:23)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 passed, 2 total
Snapshots:   0 total
Time:        0.689 s
Ran all test suites matching tests/transferService.smoke2.test.js.
  FAIL 
 
======================================================== 
 TEST RUN COMPLETE 
======================================================== 
